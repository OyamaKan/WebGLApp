<!-- https://aframe.io/docs/1.7.0/introduction/ -->
<html>

<head>
  <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
  <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"> </script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.2/dist/aframe-physics-system.min.js"></script>
  <script>
    AFRAME.registerComponent("log", {
      tick: function (time, timeDelta) {

        const parentPosition = this.el.parentEl.getAttribute("position");
        console.log(`Position: y=${parentPosition.y}`);
      }
    });
  </script>
</head>

<!-- a-sceneが大きくなってスクロールバーが出るため非表示にする -->

<body style="margin: 0px; overflow: hidden;">
  <!--埋め込みにしないと画面サイズに合わせてバーチャルオブジェクトが伸びる-->
  <a-scene embedded arjs="patternRatio: 0.9; debug: true;" id="scene">

    <a-marker preset="custom" type='pattern' url='./pattern-opusstudio_logo_800x800.patt' id="marker">
      <a-box static-body shape="box" scale="3 0.1 3" position="0 -0.05 0"></a-box>
      <a-light type="directional" position="20 40 20" intensity="1" castShadow="true"></a-light>

      <a-box static-body shape="box" scale="2 1 0.1" position="0 0.5 1" color="#EEE"></a-box>
      <a-box static-body shape="box" scale="2 1 0.1" position="0 0.5 -1" color="#EEE"></a-box>
      <a-box static-body shape="box" scale="0.1 1 2" position="1 0.5 0" color="#EEE"></a-box>
      <a-box static-body shape="box" scale="0.1 1 2" position="-1 0.5 0" color="#EEE"></a-box>

      <a-box dynamic-body scale="0.1 0.1 0.1" position="0 0.1 0" color="#F00"></a-box>

    </a-marker>

    <a-entity camera></a-entity>

  </a-scene>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      let marker = document.querySelector("#marker");

      marker.addEventListener("markerFound", function () {
        console.log("マーカーが検出されました！");
      });

      marker.addEventListener("markerLost", function () {
        console.log("マーカーが見えなくなりました...");
      });
    });


    let scene = document.querySelector("a-marker");
    let meshes = [];
    const max = 100;

    for (let i = 0; i < max; i++) {
      let x = Math.random();
      let y = Math.random();
      let z = Math.random();

      let mesh = document.createElement("a-box");
      let scale = Math.min(0.1, Math.random() * 0.1 + 0.01);

      scene.appendChild(mesh);

      mesh.setAttribute("position", `${x} ${y} ${z}`);
      mesh.setAttribute("scale", `${scale} ${scale} ${scale}`);
      mesh.setAttribute("color", `${getRandomHSLColor()};`);
      mesh.setAttribute("mass", Math.random() * 0.1 + 0.001);

      meshes.push(mesh);
    }

    function getRandomHSLColor() {
      const h = Math.floor(Math.random() * 360); // 色相: 0〜359
      const s = Math.floor(Math.random() * 101); // 彩度: 0〜100%
      const l = Math.floor(Math.random() * 101); // 明度: 0〜100%
      return `hsl(${h}, ${s}%, ${l}%)`;
    }

    document.addEventListener("click", (doc, event) => {

      for (let i = 0; i < max; i++) {
        let mesh = meshes[i];
        mesh.setAttribute("dynamic-body","");
      }
    });
  </script>
</body>